# 🏗️ Архитектура системы

## Схема работы

```
┌─────────────────────────────────────────────────────────────┐
│                    ДЕСКТОПНОЕ ПРИЛОЖЕНИЕ                    │
│                     (main.py + PyQt6)                       │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │  Добавление  │  │   Просмотр   │  │   Экспорт    │     │
│  │  документов  │  │    архива    │  │  (Excel/CSV) │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                              │
│                    ┌──────────────────┐                     │
│                    │ Печать наклеек   │                     │
│                    │   с QR-кодами    │                     │
│                    └──────────────────┘                     │
│                           │                                  │
│                           ▼                                  │
│                    ┌──────────────┐                         │
│                    │  PDF файл с  │                         │
│                    │   наклейками │                         │
│                    └──────────────┘                         │
└─────────────────────────────────────────────────────────────┘
                           │
                           │ SQLite БД
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    БАЗА ДАННЫХ (SQLite)                     │
│                    data/archive.db                          │
│                                                              │
│  • Элементы (документы, папки, коробки)                    │
│  • Реестр документов                                         │
│  • Иерархические связи                                       │
└─────────────────────────────────────────────────────────────┘
                           │
                           │ Чтение данных
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    ВЕБ-СЕРВЕР                               │
│                  (web_server.py)                           │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   Главная    │  │   Сканер     │  │  Информация │     │
│  │   страница   │  │   QR-кодов   │  │  о коробке  │     │
│  │      /       │  │   /scanner   │  │  /box/{id}  │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
│                                                              │
│  • PWA манифест (/manifest.json)                           │
│  • Иконки (/icon-192.png, /icon-512.png)                   │
│  • API для получения данных о коробках                     │
└─────────────────────────────────────────────────────────────┘
                           │
                           │ HTTPS
                           ▼
┌─────────────────────────────────────────────────────────────┐
│              ОБЛАЧНЫЙ ХОСТИНГ                               │
│         (Railway / Render / Heroku)                         │
│                                                              │
│  • Автоматическое развертывание                             │
│  • HTTPS сертификат                                         │
│  • Переменные окружения (BASE_URL, PORT)                    │
└─────────────────────────────────────────────────────────────┘
                           │
                           │ HTTPS
                           ▼
┌─────────────────────────────────────────────────────────────┐
│              МОБИЛЬНОЕ УСТРОЙСТВО                           │
│                                                              │
│  ┌────────────────────────────────────────────┐            │
│  │         PWA ПРИЛОЖЕНИЕ                     │            │
│  │  (Установлено на главный экран)           │            │
│  │                                            │            │
│  │  ┌──────────────┐  ┌──────────────┐      │            │
│  │  │   Сканер     │  │  Просмотр    │      │            │
│  │  │   QR-кодов   │  │  информации  │      │            │
│  │  │   (камера)   │  │  о коробке   │      │            │
│  │  └──────────────┘  └──────────────┘      │            │
│  └────────────────────────────────────────────┘            │
│                                                              │
│  • Доступ к камере для сканирования QR                      │
│  • Офлайн-поддержка (базовые функции)                      │
│  • Нативный интерфейс                                       │
└─────────────────────────────────────────────────────────────┘
                           │
                           │ Сканирование QR
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    НАКЛЕЙКА НА КОРОБКЕ                      │
│                                                              │
│  ┌────────────────────────────────────┐                    │
│  │  📦 Название коробки               │                    │
│  │  📍 Стеллаж А, Полка 1             │                    │
│  │                                    │                    │
│  │              ┌──────┐              │                    │
│  │              │ QR   │              │                    │
│  │              │ код  │              │                    │
│  │              └──────┘              │                    │
│  └────────────────────────────────────┘                    │
│                                                              │
│  QR-код содержит: https://your-app.railway.app/box/{id}    │
└─────────────────────────────────────────────────────────────┘
```

## Поток данных

### 1. Добавление данных
```
Пользователь → Десктопное приложение → SQLite БД
```

### 2. Генерация наклеек
```
Десктопное приложение → Чтение из БД → Генерация PDF с QR-кодами
```

### 3. Сканирование QR-кода
```
Мобильное устройство → Сканирование QR → Запрос к веб-серверу → Чтение из БД → Отображение информации
```

## Компоненты системы

### Десктопное приложение
- **main.py** - Точка входа
- **view_window.py** - Окно просмотра и экспорта
- **edit_window.py** - Редактирование элементов
- **dialogs.py** - Диалоговые окна
- **data_manager.py** - Работа с БД
- **models.py** - Модели данных

### Веб-сервер
- **web_server.py** - HTTP сервер
  - Обработка запросов
  - Генерация HTML
  - API для данных

### Мобильное приложение
- **PWA** (Progressive Web App)
  - Работает в браузере
  - Можно установить на главный экран
  - Доступ к камере
  - Офлайн-поддержка

## Технологии

### Backend
- **Python 3.9+**
- **PyQt6** - GUI приложение
- **SQLite** - База данных
- **ReportLab** - Генерация PDF
- **qrcode** - Генерация QR-кодов

### Frontend (Web)
- **HTML5** - Разметка
- **CSS3** - Стили
- **JavaScript** - Интерактивность
- **html5-qrcode** - Сканирование QR

### Инфраструктура
- **Railway / Render / Heroku** - Хостинг
- **PWA** - Мобильное приложение
- **HTTPS** - Безопасное соединение

## Безопасность

- ✅ HTTPS для всех соединений
- ✅ Валидация входных данных
- ✅ Защита от SQL-инъекций (параметризованные запросы)
- ✅ Ограничение доступа к камере (только через HTTPS)

## Масштабируемость

- ✅ Легко развертывается на любом Python-хостинге
- ✅ SQLite можно заменить на PostgreSQL для больших объемов
- ✅ Статические файлы можно вынести на CDN
- ✅ API можно расширить для интеграции с другими системами
